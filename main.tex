\documentclass{scrbook}
\KOMAoptions{paper=a4, fontsize=12pt, chapterprefix=true, twoside=semi, DIV=classic, parskip=half}

\usepackage[T1]{fontenc}
\usepackage[sf]{noto}
\linespread{1.25}

\usepackage{scrlayer-scrpage}
\usepackage{enumitem}

\KOMAoptions{headsepline=on, captions=besidetop, DIV=last}

\pagestyle{scrheadings}
\automark[section]{chapter}
\setkomafont{pagehead}{\color{RoyalBlue}\slshape\bfseries}
\setkomafont{caption}{\itshape}
\renewcommand*{\chaptermarkformat}{\chapapp~\thechapter\autodot~--~}
\ofoot*{}
\cfoot*{\pagemark}

\addtokomafont{chapterprefix}{\itshape\color{white}}
\renewcommand*{\chapterformat}{\raggedleft\colorbox{RoyalBlue}{\parbox[b][2.8em]{2.8em}{\vfill\centering{\large\chapapp}\\[-0.4em]\thechapter\vfill}}}
\renewcommand*{\chapterheadstartvskip}{\addvspace{2em}}
\renewcommand*{\chapterheadendvskip}{\pgfornament[width=\textwidth]{88}\par}

\renewcommand*{\sectionformat}{\colorbox{black}{\textcolor{white}{\thesection}}\enskip}
\renewcommand*{\sectionlinesformat}[4]{\makebox[0pt][l]{\rule[-\fboxsep-\fboxrule]{\textwidth}{\fboxrule}}#3\parbox[b]{0.85\textwidth}{\linespread{1}\selectfont#4}}

\usepackage{graphicx}
\usepackage[svgnames, dvipsnames]{xcolor}
\usepackage[many]{tcolorbox}
\usepackage{pgfornament}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{bm}
\usepackage{physics}
\usepackage{siunitx}
\usepackage{mathtools}
\usepackage{lipsum}
\usepackage{microtype}
\usepackage{tabularx}
\usepackage{adjustbox}
\usepackage{subcaption}
\usepackage{parcolumns}
\usepackage{multicol}
\usepackage{ifthen}
\usepackage{pgfmath}
\usepackage{pgffor}
\usepackage{lineno}
\usepackage{imakeidx}
\makeindex[intoc, options=-s myindexstyle]
\usepackage{CJKutf8}
\usepackage[style=ieee]{biblatex}
\addbibresource{references.bib}
\nocite{*}

\begin{filecontents}[overwrite]{myindexstyle.ist}
headings_flag 1
heading_prefix
 "\\bigskip\\par\\penalty-50\\textbf{"
heading_suffix
 "}\\\\[\\medskipamount]"
symhead_positive "Symbols"
symhead_negative "symbols"
numhead_positive "Numbers"
numhead_negative "numbers"
delim_0 ",\~"
\end{filecontents}

\definecolor{mint}{rgb}{0.24, 0.71, 0.54}

\usepackage[lastexercise,answerdelayed]{exercise}
\renewcounter{Exercise}[chapter]
\renewcommand*{\theExercise}{\thechapter.\arabic{Exercise}}
\renewcommand*{\ExerciseHeader}{\textbf{\theExercise )}}
\renewcommand*{\AnswerHeader}{\noindent \textbf{\theExercise}}
\renewcommand*{\ExerciseSkipBefore}{\dimexpr.5\baselineskip}
\renewcommand*{\ExerciseSkipAfter}{\dimexpr.5\baselineskip}

\newtcolorbox{exercisebox}[1][]{
  colback=Mahogany!20, 
  colbacktitle=Mahogany!10,
  coltitle=black,
  colframe=Mahogany,
  fonttitle=\bfseries,
  title=Exercise(s),
  boxrule=0pt,
  leftrule=1ex,
  left=0pt,
  right=0pt,
  before=0pt,
  after=0pt,
  boxsep=1ex,
  toptitle=1ex,
  bottomtitle=1ex,
  top=0pt,
  left=1ex,
  right=1ex,
  bottom=0.5ex,
  pad after break=1.5ex,
  sharp corners,
  breakable,
  before skip=\topsep,
  after skip=\topsep, #1}
\newtcolorbox{mybox}[1][]{
  colback=Green!20, 
  colframe=Gray,
  coltitle=Yellow,
  title=This is my box,
  boxrule=1pt,
  leftrule=1ex,
  boxsep=1ex,
  left=1ex,
  right=1ex,
  sharp corners,
  breakable,
  before skip=\topsep,
  after skip=\topsep, #1}

\newtcbtheorem[number within=chapter]{thm}{Theorem}{
  colback=Green!20,
  colframe=Green!50,
  fonttitle=\bfseries,
  boxrule=1pt,
  boxsep=1ex,
  left=1ex,
  right=1ex,
  pad after break=1.5ex,
  sharp corners,
  breakable,
  before skip=\topsep,
  after skip=\topsep}{thm}
\tcbset{mycommon/.style={
  colback=Green!20,
  colframe=Green!50,
  fonttitle=\bfseries,
  coltitle=black,
  theorem style=plain,
  boxrule=1pt,
  boxsep=1ex,
  left=1ex,
  right=1ex,
  pad after break=1.5ex,
  sharp corners,
  breakable,
  before skip=\topsep,
  after skip=\topsep}
}
\newtcbtheorem[use counter from=thm]{defn}{Definition}{mycommon}{defn}
\tcbuselibrary{theorems}

\tcolorboxenvironment{proof}{
  blank,
  breakable,
  borderline west={0.5ex}{2pt}{black},
  left=2ex,
  before skip=\topsep,
  after skip=\topsep}
\newenvironment*{solution}{\begin{proof}[Solution]}{\end{proof}}
 
\usepackage{listings}
\lstdefinestyle{lstTeXstyle}{
    language=[latex]TeX, 
    basicstyle=\footnotesize\ttfamily,
    backgroundcolor=\color{Goldenrod!20},
    keywordstyle=\color{blue!80}\bfseries,
    commentstyle=\color{Green},
    breaklines=true,
    showstringspaces=false,
    numbers=none,
    belowskip=0pt,
    escapeinside={/*!}{!*/},
}
\lstset{style=lstTeXstyle}

\usepackage{hyperref}
\hypersetup{
    colorlinks,
    linkcolor = black,
    urlcolor = blue!90!Green,
    citecolor = blue!90!Green,
    pdfauthor = Benjamin Loi,
    pdftitle = How to Reproduce this Book Exactly with LATEX,
    pdfsubject = v1.0.0,
    pdfkeywords = {Mathematics, LATEX}
}

\usepackage[open,openlevel=1,atend,numbered]{bookmark}

\usepackage{pgfplots}

\setfootnoterule{0.8\textwidth}

\newboolean{firstanswerofthechapter}  
\renewcommand*{\AnswerHeader}{\ifthenelse{\boolean{firstanswerofthechapter}}
    {\textbf{Answers for Chapter \thechapter}\par\vspace{1ex}%
     \theExercise)}
    {\theExercise)}
}

\title{How to Reproduce this Book Exactly with \LaTeX}
\subtitle{A Self-contained Tutorial on Writing Mathematical Notes}
\author{C.~L.~Loi}
\lowertitleback{"How to Reproduce this Book Exactly with \LaTeX"\\
Copyright Â©, C.~L.~Loi, 2025. All rights reserved.}

\usetikzlibrary{calc, angles, quotes, intersections, decorations.pathmorphing, decorations.shapes, arrows.meta, decorations.markings, patterns, matrix, positioning, backgrounds, tikzmark, shapes.geometric}
\usepackage{tikz-3dplot}
\usepackage{circuitikz}

%\setcounter{tocdepth}{}
\allowdisplaybreaks

\begin{document}

\frontmatter
\include{front_matter}

\mainmatter
\include{ch0_install}
\include{ch1_basic_structure}
\include{ch2_text_format}
\include{ch3_maths_writing}
\include{ch4_list_figure}
\include{ch5_commands_envs}
\include{ch6_design_layout}
\include{ch7_thm_ex}
\include{ch8_tikz_plot}
\include{ch9_more_tikz}
\include{ch10_misc}

\backmatter
\include{back_matter}

\end{document}
