\chapter{More on Book Layout Design}

\paragraph{Introduction}
This chapter will go into the details about designing and refining the layout of a \LaTeX{} book, including how to edit the page style with running headers/footers, chapter/section headings, a good-looking title page, and more.

\section{Page Configuration}

\subsection{Some Universal Settings for the Pages}

\paragraph{twoside}
In a printed book, there will be a distinction between odd (right) and even (left) pages, i.e.\ \textit{two-sided}, whereas an electronic PDF document is usually \textit{one-sided} and has no such issue. To choose one of these configurations in a \texttt{scrbook}, we can change the \texttt{twoside} parameter in \texttt{\textbackslash KOMAoptions} to \texttt{false}, \texttt{semi}, or \texttt{true}. Unsurprisingly, \texttt{false} indicates one-sided and \texttt{true} means two-sided. Being two-sided means that there will be a difference between the inner/outer margins, with the outer margin (left/right on even/odd pages) occupying two times the space as the inner one. The running headers on odd and even pages will also show the current section/chapter differently.

In this book, the \texttt{twoside} option is set to \texttt{semi} by adding \texttt{\textbackslash KOMAoptions\allowbreak\{twoside=semi\}}. This retains equal margins as if the document is one-sided, but the headers will switch alternately just like two-sided.

\paragraph{DIV}
The extent of the type area in pages is controlled by the \texttt{DIV} factor passed to \texttt{\textbackslash KOMAoptions}. The higher the value of \texttt{DIV}, the larger the fraction of the main text area and the smaller the margins. The reference value of \texttt{DIV} usually ranges from $9$ to $12$. However, we can delegate the calculation of an optimal \texttt{DIV} by setting \texttt{DIV} to either \texttt{calc} or \texttt{classic}. If a new font is loaded, it is also desirable to recalculate an appropriate type area by calling \texttt{\textbackslash KOMAoptions\{DIV=last\}} that reuses the same setting.

\paragraph{linespread}
Finally, to control the \textit{line spread} in the main text, just add \texttt{\textbackslash linespread\{<value>\}}. Here it is set to $1.25$.

\subsection{Page Style}

\paragraph{Headers and Footers}
A very important part of a page is its \textit{header} and \textit{footer}. Editing the content within a header/footer requires us to load the \texttt{scrlayer-\allowbreak scrpage} package. The default page style for the main content in the book is invoked by \texttt{\textbackslash pagestyle\{scrheadings\}}. We can refer the inner/center/outer header/footer via \texttt{ihead}, \texttt{chead}, \texttt{ohead}, \texttt{ifoot}, \texttt{cfoot}, and \texttt{ofoot} correspondingly. For example, the default page number is put at the outer footer, and this book has moved it to the center footer by declaring:
\begin{lstlisting}
\pagestyle{scrheadings}
\ofoot*{}
\cfoot*{\pagemark}    
\end{lstlisting}
where the variable \texttt{\textbackslash pagemark} stores the page number in \texttt{scrbook}.

There is also a finer division between even/odd pages for headers/footers: \texttt{lehead}, \texttt{cehead}, \texttt{rehead}, \texttt{lohead}, \texttt{cohead}, \texttt{rohead}, where \texttt{l}, \texttt{c}, \texttt{r} stand for left/center/right, and \texttt{e}, \texttt{o} represent even and odd respectively. If we want to swap the chapter and section in the even/odd-paged headers, we can write something like
\begin{lstlisting}
\lehead*[]{\rightmark}
\rohead*[]{\leftmark}    
\end{lstlisting}
The optional argument will be applied to the chapter page (more accurately, the \textit{plain} page style), and is left empty as in the default setting. The \texttt{\textbackslash leftmark} and \texttt{\textbackslash rightmark} hold the original left/right headers, the depth of which is controlled by
\begin{lstlisting}
\automark[section]{chapter} % [right]{left}
\end{lstlisting}

\paragraph{setkomafont}
Now we will further customize the font style and color of our header by the command \texttt{\textbackslash setkomafont\{<element>\}\{<commands>\}}. As its name suggests, it applies commands to set up a certain element in a page. For headers, the corresponding alias is \texttt{pagehead}, and in this book, we have
\begin{lstlisting}
\setkomafont{pagehead}{\color{RoyalBlue}\slshape\bfseries}    
\end{lstlisting}
Many other elements can be changed as well, including \texttt{chapter}, \texttt{section}, \texttt{footnote}, \texttt{caption}, \texttt{pagefoot}, and so on.

\paragraph{headsepline}
The separating line under the header is added via passing the switch \texttt{headsepline=on} to \texttt{\textbackslash KOMAoptions}. We similarly have \texttt{footsepline}.

\paragraph{chaptermarkformat}
Sometimes we may want to change the chapter label in the header too. This is done by applying \texttt{\textbackslash renewcommand*} to \texttt{\textbackslash chaptermarkformat}. In this book, we have
\begin{lstlisting}
\renewcommand*{\chaptermarkformat}{\chapapp~\thechapter\autodot~--~} % ~ occupies a space, -- is a dash
\end{lstlisting}
\texttt{\textbackslash chapapp} stores the word "Chapter", \texttt{\textbackslash thechapter} contains the current chapter counter, and \texttt{\textbackslash autodot} is empty, reserved for an extra dot after any chapter/section numbering. As you may have guessed, there is also \texttt{\textbackslash sectionmarkformat}.

\begin{exercisebox}
\begin{Exercise}
Edit the page style to make your own header and footer.
\end{Exercise}
\end{exercisebox}

\section{Appearance of Chapters and Sections}

\paragraph{chapterprefix, chapterformat}
We can single out the chapter number as a prefix in the chapter title by setting \texttt{chapterprefix=true} in \texttt{\textbackslash KOMAoptions}. Furthermore, we can customize it by \texttt{\textbackslash addtokomafont} which behaves similarly as \texttt{\textbackslash setkomafont}:
\begin{lstlisting}
\addtokomafont{chapterprefix}{\itshape\color{white}}
\end{lstlisting}
In addition, we can again call \texttt{\textbackslash renewcommand*} to manipulate \texttt{\textbackslash chapterformat}. In this book, the following code is adopted:
\begin{lstlisting}
\renewcommand*{\chapterformat}{\raggedleft\colorbox{RoyalBlue}{\parbox[b][2.8em]{2.8em}{\vfill\centering{\large\chapapp}\\[-0.4em]\thechapter\vfill}}}  
\end{lstlisting}

\paragraph{sectionformat}
In the same way, we have \texttt{\textbackslash sectionformat} that can be edited for section headings. The code to produce the white section number in a black box is
\begin{lstlisting}
\renewcommand*{\sectionformat}{\colorbox{black}{\textcolor{white}{\thesection}}\enskip}    
\end{lstlisting}
where \texttt{\textbackslash enskip} denotes a space as wide as half an em.

\paragraph{sectionlinesformat}
Meanwhile, the black line under the section headings is governed by \texttt{\textbackslash sectionlinesformat}. It has to accept $4$ arguments, where only the third (section number) and the last (section name) will be relevant here:
\begin{lstlisting}
\renewcommand*{\sectionlinesformat}[4]{\makebox[0pt][l]{\rule[-\fboxsep]{\textwidth}{1pt}}#3\parbox[b]{0.85\textwidth}{\linespread{1}\selectfont#4}}
\end{lstlisting}
The \texttt{makebox} command creates an artificial empty box that does not occupy any width ($0$ pt) and contains the desired separating line (\texttt{\textbackslash rule} with a length of \texttt{\textbackslash textwidth}). It is vertically offset downwards by \texttt{\textbackslash fboxsep} to compensate for the padding around the black numbering box (\texttt{\#3}) that follows, defined via \texttt{\textbackslash sectionformat} above. The section name (\texttt{\#4}) is subsequently wrapped by a \texttt{\textbackslash parbox} that is bottom-aligned and can account for any title longer than one line.

\paragraph{chapterheadendvskip}
While there is also the \texttt{\textbackslash chapterlinesformat} command for making a line below the chapter title, we can achieve more by tackling \texttt{\textbackslash chapterheadendvskip} instead. It controls the stuff (usually some vertical skip) that occurs after a chapter heading. For aesthetics, we will load the \texttt{pgfornament} package that supplies many beautiful visual patterns. Then, we can write
\begin{lstlisting}
\renewcommand*{\chapterheadendvskip}{\pgfornament[width=\textwidth]{88}\par} % the 88th ornament
\end{lstlisting}
to achieve the layout present in the book.

\paragraph{chapterheadstartvskip}
There exists the \texttt{\textbackslash chapterheadstartvskip} counterpart for anything before the chapter title as well. The default vertical space above the chapter heading may be too much, and we can shorten it via 
\begin{lstlisting}
\renewcommand*{\chapterheadstartvskip}{\addvspace{2em}}    
\end{lstlisting}
\texttt{\textbackslash addvspace} is a variant of \texttt{\textbackslash vspace}, which is a kind of rubber length: it adds just enough vertical space so that the total space is as large as the input length if the existing space is shorter than that, and does nothing when it is already long enough.

\paragraph{sfdefaults} As you may notice, the chapter/section headings are written in sans-serif. To change this, we can set \texttt{sfdefaults} to \texttt{no} in \texttt{\textbackslash KOMAoptions}. We can also mark up text with \texttt{\textbackslash textmaybesf\{<text>\}} that is toggled by  \texttt{sfdefaults} too.

\section{Title Page and Front/Back Matter}

\paragraph{Title Page}
The easiest way to generate a \textit{title page} is to simply use the \texttt{\textbackslash maketitle} command. Just enter the book (sub)title, author name, and the like in the preamble using the corresponding commands, for example:
\begin{lstlisting}
\title{How to Reproduce this Book Exactly with \LaTeX}
\subtitle{A Self-contained Tutorial on Writing Mathematical Notes}
\author{C.~L.~Loi}
\end{lstlisting}
and maybe \texttt{\textbackslash date} and \texttt{\textbackslash publishers}, etc. Then calling \texttt{\textbackslash maketitle} will automatically build a title page for you. In addition, the \texttt{titlepage} switch in \texttt{\textbackslash KOMAoptions} can decide if it is embedded in-page. However, it is more flexible to design our own title page using the \texttt{titlepage} environment. In this book, we have adopted:
\begin{lstlisting}
\begin{titlepage}
\parbox{0.7\textwidth}{\Huge\raggedright\textbf{\textmaybesf{How to Reproduce this Book Exactly with \LaTeX}}}\par
\vspace{2mm}
\parbox[b]{0.9\textwidth}{\large\raggedright\textit{A Self-contained Tutorial on Writing Mathematical Notes}}
\hfill\textcolor{RoyalBlue}{\rule{3mm}{3mm}}\par
\vspace{4mm}\hrule\par
{\Large\raggedleft\textmaybesf{v1.0.0}\hfill C.~L.~Loi\par}
\vfill
{\large\raggedleft A student from \\ 
CUHK-EESC/NTU-AS\par}
\end{titlepage}
\end{lstlisting}

\paragraph{Front/Main/Back Matter} Usually in a book, there will be \textit{front matter} (title page, preface, table of contents) and \textit{back matter} (bibliography, index). To mark them, just write \texttt{\textbackslash frontmatter} and \texttt{\textbackslash backmatter} in front of the corresponding parts. We also have \texttt{\textbackslash mainmatter} for transitioning to the main content. So it should look like
\begin{lstlisting}
\frontmatter
\include{ch0}

\mainmatter
\include{ch1_basic_structure}
...
\end{lstlisting}
\texttt{\textbackslash frontmatter} will use Roman page numbering, and \texttt{\textbackslash mainmatter} will switch it back to the normal Arabic numbering. We can also manually do this by
\begin{lstlisting}
\pagenumbering{roman}
...
\cleardoubleoddpage
\pagenumbering{arabic}
\end{lstlisting}
The \texttt{\textbackslash cleardoubleoddpage} command is needed to properly flush the page.

\paragraph{lowertitleback, uppertitleback} Sometimes we may want to put a copyright statement or other information at the back of the title page. If we choose to create the title page by the \texttt{\textbackslash maketitle} method, then we can simply supply the \texttt{\textbackslash lowertitleback} or \texttt{\textbackslash uppertitleback} command, e.g.\ for this book:
\begin{lstlisting}
\lowertitleback{"How to Reproduce this Book Exactly with \LaTeX"\\
Copyright, C.~L.~Loi, 2025. All rights reserved.}    
\end{lstlisting}
However, if the title page is designed manually, then we may instead write, after it:
\begin{lstlisting}
\thispagestyle{empty}
\vspace*{\fill}
"How to Reproduce this Book ... All rights reserved.
\end{lstlisting}
\texttt{\textbackslash thispagestyle\{empty\}} selects the \texttt{empty} page style for just this one page.

\begin{exercisebox}
\begin{Exercise}
Design your own title page.
\end{Exercise}
\end{exercisebox}

\section{Footnotes and Markings}

(Line numbers?)

\subsection{Footnotes}

\paragraph{Footnotes}
The basic way to add a footnote like this\footnote{This is a simple footnote that is directly inserted after the desired location.} is to use the \texttt{\textbackslash footnote\allowbreak\{<text>\}} command, as
\begin{lstlisting}
The basic way to add a footnote like this\footnote{This is a simple footnote that is directly inserted after the desired location.} is ...   
\end{lstlisting}
Another way is to use the \texttt{\textbackslash footnotemark} \texttt{\textbackslash footnotetext} pair like this\footnotemark{}
\begin{lstlisting}
Another way is to use the \texttt{\textbackslash footnotemark} \texttt{\textbackslash footnotetext} pair like this\footnotemark{}
...
where we can put the text anywhere after the mark.\footnotetext{This footnote by \texttt{\textbackslash footnotetext} will automatically be traced to the latest texttt{\textbackslash footnotemark}.}
\end{lstlisting}
where we can put the text anywhere after the mark.\footnotetext{This footnote by \texttt{\textbackslash footnotetext} will automatically be traced to the latest \texttt{\textbackslash footnotemark}.}

\paragraph{Multiple Footnote Marks}
If there are more than one \texttt{\textbackslash footnotemark} before a \texttt{\textbackslash footnotetext}, the index of the \texttt{\textbackslash footnotetext} will be set according to the newest \texttt{\textbackslash footnotemark}. This can be problematic if the previous \texttt{\textbackslash footnotetext} are delayed. Here we demonstrate the fix\footnotemark{} for such a scenario\footnotemark{}.
\footnotetext[\numexpr\value{footnote}-1]{We manually decrease the footnote counter by $1$ here with \texttt{\textbackslash footnotetext[\textbackslash numexpr\allowbreak\textbackslash value\{footnote\}-1]}.}
\footnotetext{Try removing the patch above, and the numbering will clash.}

\paragraph{Separating Line for Footnotes} 
To customize the appearance of the separating line above the footnotes, we can call \texttt{\textbackslash renewcommand*\{\textbackslash footnoterule\}\allowbreak\{<code>\}}. For example, this book uses
\begin{lstlisting}
\renewcommand{\footnoterule}{\rule{0.8\textwidth}{1pt}\vspace*{1ex}}
\end{lstlisting}

\paragraph{Referencing Footnote}
A footnote can be labeled and referenced as well. Just put \texttt{\textbackslash label\{<label\_name>\}} inside the footnote and use \texttt{\textbackslash ref} as for other elements.

\subsection{Hyperlinks and Bookmarks}

\paragraph{Hyperlinks} 
To enable inserting hyperlinks (e.g.\ websites, or referencing in the book) in the document, we need to import the \texttt{hyperref} package. Then we can simply use the \texttt{\textbackslash href\{<link>\}\allowbreak\{<text>\}} command, for example
\begin{lstlisting}
\href{https://www.google.com/}{Google}
\end{lstlisting}
yields the link to \href{https://www.google.com/}{Google}. Internal referencing links will be automatically formed.

\paragraph{Highlighting Options for hyperref} The default highlighting effects for hyperlinks by \texttt{hyperref} can be controlled by \texttt{\textbackslash hypersetup}. In this book, we have used
\begin{lstlisting}
\hypersetup{
    colorlinks,
    linkcolor = black,
    urlcolor = blue!90!Green,
    pdfauthor = Benjamin Loi,
    pdftitle = How to Reproduce this Book Exactly with LATEX,
    pdfsubject = v1.0.0,
    pdfkeywords = {Mathematics, LATEX}
}
\end{lstlisting}
The \texttt{colorlinks} keyword replaces the default colored boxes by colored text, while \texttt{linkcolor} and \texttt{urlcolor} indicate the color for internal and external links respectively. The subsequent options are a by-product to set up the metadata for the PDF file.

\paragraph{PDF Bookmarks} To further facilitate the PDF file, we can load the \texttt{bookmark} package with the following options:
\begin{lstlisting}
\usepackage[open,openlevel=1,atend,numbered]{bookmark}
\end{lstlisting}
The \texttt{open} and \texttt{openlevel} options tell to which depth the bookmarks are expanded when the PDF file is open, while the \texttt{numbered} option reinstates the chapter/section numbering at the start of each bookmark.
